<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cartwright Ranch - Trick or Treat Map</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>
</head>
<body>
    <div id="header">
        <h1>🎃 Cartwright Ranch Trick or Treat Map 🍬</h1>
        <p class="subtitle">Click on the map to mark if you're handing out candy!</p>
    </div>
    
    <div id="controls">
        <button id="addMarkerBtn" class="btn btn-primary">📍 Mark My House</button>
        <button id="toggleMapBtn" class="btn btn-toggle">🗺️ Google Maps</button>
        <button id="zoomInBtn" class="btn btn-zoom">🔍 +</button>
        <button id="zoomOutBtn" class="btn btn-zoom">🔍 -</button>
        <div class="legend">
            <span class="legend-item">🎃 = Giving out candy!</span>
        </div>
    </div>
    
    <div id="mapContainer">
        <div id="map">
            <!-- Neighborhood image will be displayed here -->
            <img id="neighborhoodImage" src="neighborhood-map.jpg" alt="Neighborhood Map" />
        </div>
        <div id="googleMap" style="display:none;">
            <!-- Google Maps will be rendered here -->
        </div>
    </div>
    
    <div id="instructions">
        <h3>How to use:</h3>
        <ol>
            <li>Click the "📍 Mark My House" button to enable marking mode</li>
            <li>Click on your house location on the neighborhood map</li>
            <li>Your house will be marked with a 🎃 pumpkin icon</li>
            <li>Click on any existing marker to remove it</li>
            <li>Use zoom buttons to adjust the view</li>
        </ol>
        <p class="note"><strong>Note:</strong> Markers are shared across all users in real-time!</p>
        
        <div style="margin-top: 20px; padding: 15px; background: rgba(255, 255, 255, 0.1); border-radius: 8px;">
            <h4 style="color: #ffa500; margin-bottom: 10px;">🗺️ Using Your Own Neighborhood Map:</h4>
            <p>For the best experience, add your own neighborhood image:</p>
            <ol>
                <li>Take a screenshot of your neighborhood from Google Maps, Apple Maps, or satellite imagery</li>
                <li>Save the image as <strong>"neighborhood-map.jpg"</strong></li>
                <li>Place it in the same folder as this HTML file</li>
                <li>Refresh the page to see your custom map!</li>
            </ol>
            <p><em>Supported formats: .jpg, .jpeg, .png, .gif</em></p>
        </div>
    </div>
    
    <div id="config-notice" style="display:none;">
        <div style="background: #fff3cd; color: #856404; padding: 15px; margin: 20px; border-radius: 8px; text-align: center;">
            <strong>⚠️ Configuration Required</strong>
            <p>Please add your Firebase and Google Maps API keys to secrets to enable shared markers and map view.</p>
        </div>
    </div>
    
    <!-- GitHub Pages deployment status -->
    <div id="deployment-status" style="display:none; position: fixed; bottom: 20px; right: 20px; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 5px; font-size: 12px; max-width: 300px;">
        <div>🚀 <strong>GitHub Pages Status</strong></div>
        <div id="firebase-status">🔥 Firebase: <span>Checking...</span></div>
        <div id="maps-status">🗺️ Google Maps: <span>Checking...</span></div>
        <div id="image-status">🖼️ Map Image: <span>Checking...</span></div>
        <div id="storage-status">💾 Storage: <span>Checking...</span></div>
    </div>
    
    <!-- Runtime configuration (created by GitHub Actions) -->
    <script src="config.js"></script>
    <script src="app.js"></script>
    <!-- Google Maps API - Will be dynamically loaded by JavaScript with secure API key -->
    <script>
        // Google Maps API will be loaded dynamically by app.js if API key is configured
        // This keeps the API key secure and out of the HTML source
        
        // Debug helper for GitHub Pages deployment
        window.addEventListener('DOMContentLoaded', () => {
            console.log('🎃 Trick or Treat Map loaded');
            console.log('Current URL:', window.location.href);
            
            // Check if running on GitHub Pages
            if (window.location.hostname.includes('github.io')) {
                console.log('✅ Running on GitHub Pages');
                // Show deployment status for GitHub Pages
                document.getElementById('deployment-status').style.display = 'block';
                updateDeploymentStatus();
            } else {
                console.log('ℹ️ Running locally');
            }
        });
        
        function updateDeploymentStatus() {
            // Check Firebase status
            setTimeout(() => {
                const firebaseStatus = document.getElementById('firebase-status').querySelector('span');
                const isFirebaseConfigured = window.FIREBASE_CONFIG && window.FIREBASE_CONFIG.apiKey !== 'PLACEHOLDER_FIREBASE_API_KEY';
                firebaseStatus.textContent = isFirebaseConfigured ? '✅ Configured' : '❌ Not configured (localStorage fallback)';
                firebaseStatus.style.color = isFirebaseConfigured ? '#28a745' : '#dc3545';
            }, 1000);
            
            // Check Google Maps status
            setTimeout(() => {
                const mapsStatus = document.getElementById('maps-status').querySelector('span');
                const isMapsConfigured = window.GOOGLE_MAPS_API_KEY && window.GOOGLE_MAPS_API_KEY !== 'PLACEHOLDER_GOOGLE_MAPS_API_KEY';
                mapsStatus.textContent = isMapsConfigured ? '✅ Configured' : '❌ Not configured';
                mapsStatus.style.color = isMapsConfigured ? '#28a745' : '#dc3545';
            }, 1500);
            
            // Check image status  
            const img = document.getElementById('neighborhoodImage');
            const imageStatus = document.getElementById('image-status').querySelector('span');
            img.onload = () => {
                imageStatus.textContent = '✅ Custom image loaded';
                imageStatus.style.color = '#28a745';
            };
            img.onerror = () => {
                imageStatus.textContent = '⚠️ Using placeholder';
                imageStatus.style.color = '#ffc107';
            };
            
            // Check storage
            const storageStatus = document.getElementById('storage-status').querySelector('span');
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                storageStatus.textContent = '✅ Available';
                storageStatus.style.color = '#28a745';
            } catch (e) {
                storageStatus.textContent = '❌ Blocked';
                storageStatus.style.color = '#dc3545';
            }
        }
    </script>
</body>
</html>